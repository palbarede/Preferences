# ==================
# tmux configuration
# ==================
#
# <<Perche' screen e' anni '90.>>
#	-- Anonimo

# Imposta TERM per supportare 256 colori senza dover lanciare tmux con "-2"
#set -g default-terminal "xterm-256color"

# intervallo update in secondi
# set -g status-interval 60
set -g status-interval 15

# left status bar (256 colors)
# >>> {session name} window_id:window_name
set -g status-left "#[fg=colour202,bold]{#[default]#[fg=colour214,bold,bg=colour235]#S#[default]#[fg=colour202,bold]}#[default]"

# right status bar (256 colors)
set -g status-right-length 70
set -g status-right "RX: #($HOME/bin/dimeter.zsh) %A %d %B %G, %H:%M #[fg=colour214,bold]#($HOME/bin/fuzzyclock.zsh)#[default]"

# turn off automatic renaming
set-window-option -g automatic-rename on

# su linux ho avuto problemi con il PATH, ho dovuto aggiungere:
# set -g default-shell '/bin/zsh'
# set-option -g default-command "exec /bin/zsh"
#set-option -g default-command "exec $SHELL"
# NOTA: DEVE ESSERE IL PATH COMPLETO
## if '[ -e /bin/zsh ]' 'set -g default-command /bin/zsh ; set -g default-shell /bin/zsh'
## if '[ -e /usr/local/bin/zsh ]' 'set -g default-shell /usr/local/bin/zsh ; set -g default-command /usr/local/bin/zsh'
# fix pbcopy
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
# set-option -g default-command "reattach-to-user-namespace -l zsh"

# don't like the bell (?)
set -g bell-action current
# show tmux messages for 3000 ms
set -g display-time 1000

# status bar colors (qui sembra che i 256 colors non funzionino...)
set -g status-bg colour235
# ok 229
set -g status-fg colour250

setw -g window-status-bg colour233
setw -g window-status-fg colour247
set-window-option -g window-status-current-bg colour23
set-window-option -g window-status-current-fg colour231
setw -g window-status-current-attr "underscore"

# display-panes colors
set -g display-panes-active-colour colour214
set -g display-panes-colour colour112

# barra dei "messaggi"
set -g message-bg colour221
set -g message-fg colour016

# emacs keys, che e' meglio.
set-window-option -g mode-keys vi
set -g status-keys emacs

# enable utf8 globally
set-window-option -g utf8 on

# enable wm window titles
set -g set-titles on

# wm window title string (uses statusbar variables)
set -g set-titles-string "tmux.#I.#W"

# center align the window list
set -g status-justify centre

# open a man page in new window
bind / command-prompt "split-window 'exec man %%'"

# ssh?
bind '~' command-prompt "split-window 'exec ssh %%'"

# quick view of processes
bind 'H' split-window "exec htop"

# splitto
bind 'S' split-window


# BINDINGS
# ctrl + page up (PPage): previous window
# ctrl + page down (NPage): next window
# bind -n C-PPage previous-window
# bind -n C-NPage next-window

# alt + page up (PPage): previous window
# alt + page down (NPage): next window
bind -n M-PPage previous-window
bind -n M-NPage next-window

# alt+left: previous window
# alt+right: next window
bind -n M-left previous-window
bind -n M-right next-window

# F8: previous window
# F9: next window
bind -n F8 previous-window
bind -n F9 next-window

# Set the prefix to ^A, or `, or ^F...
#### WARNING
# C'e' un problema se uso ` come prefix, ovvero viene preso
# anche quando si incolla con il mouse... quindi se incollo
# `ciao, lo prende come un comando.
### set -g prefix "`"
### bind "`" send-prefix
unbind C-b
set -g prefix C-a
# Al contrario di quanto visto in giro e' meglio fare "bind a" piuttosto che
# "bind C-a" perche' con C-a non posso piu' fare C-a normalmente per andare a
# inizio riga nella shell.
bind a send-prefix

# Bind appropriate commands similar to screen.
# lockscreen ^X x
unbind C-X
bind C-X lock-server
unbind x
bind x lock-server

# displays *
unbind *
bind * list-clients

# next ^@ ^N sp n
unbind C-@
bind C-@ next-window
unbind C-N
bind C-N next-window
unbind " "
bind " " next-window

# title A
unbind A
bind A command-prompt "rename-window %%"

# other ^A
unbind C-A
bind C-A last-window

# prev ^H ^P p ^?
unbind C-H
bind C-H previous-window
unbind C-P
bind C-P previous-window
unbind BSpace
bind BSpace previous-window

# quit \
unbind \
bind \ confirm-before "kill-server"

# kill K k
unbind K
bind K confirm-before "kill-window"
unbind k
bind k confirm-before "kill-window"

# redisplay C-L l
unbind C-L
bind C-L refresh-client
unbind l
bind l refresh-client

# split -v |
unbind |
bind | split-window

## NOTA: nella 1.3 hanno tolto down-pane e up-pane:
## Commands up-pane, and down-pane removed, since equivalent behaviour is now
## available through the target flag (-t:+ and -t:-).
# :kB: focus up
# unbind Tab
# bind Tab down-pane
# unbind BTab
# bind BTab up-pane

# monitor activity
bind m setw monitor-activity

# Hide and show window name from status line
bind '-' setw window-status-format '#I'\; setw window-status-current-format '#I'
bind '+' setw window-status-format '#I:#W#F'\; setw window-status-current-format '#I:#W#F'

if '[ -e ~/.tmux.local ]' 'source ~/.tmux.local'

# Se c'e' SSH_CONNECTION allora siamo in remoto e quindi uso C-f al posto di C-a.
if '[ ! -z "$SSH_CONNECTION" ]' 'unbind C-a ; set -g prefix C-f ; bind C-f send-prefix'

## # nuova sessione "Info"
## new-session -d -n TOP -s SysInfo 'exec htop'
## new-window -d -n NLOAD -t SysInfo:1 'exec nload'

# copia in X clipboard
# questo funziona su linux.
bind-key C-y save-buffer ~/.tmux.buffer \; run-shell "xclip -in -selection clipboard -d :0 < ~/.tmux.buffer && rm ~/.tmux.buffer" \; display-message "Buffer copiato nella Clipboard"
## if '[ -e /bin/zsh ]' 'set -g default-command /bin/zsh ; set -g default-shell /bin/zsh'
if '[[ $OSTYPE == darwin* ]]' 'bind-key C-y save-buffer ~/.tmux.buffer \; run-shell "reattach-to-user-namespace pbcopy < ~/.tmux.buffer && rm ~/.tmux.buffer" \; display-message "Buffer copiato nella Clipboard"'


# Esempio:
### # Crea una nuova sessione "main", e una finestra "info"
### # in "info" c'e' nload, htop e iotop splittati
### new -d -s main -n info 'exec nload'
### setw -tmain:0 aggressive-resize on
### splitw -t0 'exec iotop'
### splitw -t0 'exec htop'
### selectl -t0 even-vertical
### upp
### upp
### neww

# vim: ft=tmux
