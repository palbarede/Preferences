# ==================
# tmux configuration
# ==================
#
# <<Perche' screen e' anni '90.>>
#	-- Anonimo
#
# Key bindings:
# s => choose-tree => Permette di scegliere una window/pane di una sessione
# w => choose-window => Permette di scegliere una window di questa sessione


# Imposta TERM per supportare 256 colori senza dover lanciare tmux con "-2"
#set -g default-terminal "xterm-256color"
set -g default-terminal "screen-256color"

# enable utf8 globally
set-window-option -g utf8 on
set -g status-utf8 on

# intervallo update in secondi
set -g status-interval 60
# set -g status-interval 15

# left status bar (256 colors)
# >>> {session name} window_id:window_name
#set -g status-left "#[fg=colour202,bold]{#[default]#[fg=colour214,bold,bg=colour235]#S:#I.#P#[default]#[fg=colour202,bold]}#[default]"
#set -g status-left "#[fg=colour233,bg=colour221]♮ #S:#I.#P #[bg=colour067,fg=colour233]#(~/Preferences/bin/weather.sh)#[default]"
set -g status-left "#[fg=colour233,bg=colour221]⎋ #S:#I.#P #[default]"
set -g status-left-length 20

# right status bar (256 colors)
set -g status-right-length 80
#set -g status-right "RX: #($HOME/bin/dimeter.zsh) %A %d %B %G, %H:%M #[fg=colour214,bold]#($HOME/bin/fuzzyclock.zsh)#[default]"
# set -g status-right "%A %d %B %G, %H:%M #[fg=colour214,bold]#($HOME/bin/fuzzyclock.zsh)#[default]"
#set -g status-right "%A %d %B %G, %H:%M#[default]"
set -g status-right "#[bg=colour024,fg=colour254] #(date +'%A %d %B %H:%M')#[default]"

# turn off automatic renaming
# 18/09/2012 - osx ML fa conflitto con | less, lo disattivo.
set-window-option -g automatic-rename off

# quando si chiude l'ultima finestra e ci sono ancora sessioni aperte, passa alla prima di esse.
set -g detach-on-destroy off

# su linux ho avuto problemi con il PATH, ho dovuto aggiungere:
# set -g default-shell '/bin/zsh'
# set-option -g default-command "exec /bin/zsh"
#set-option -g default-command "exec $SHELL"
# NOTA: DEVE ESSERE IL PATH COMPLETO
## if '[ -e /bin/zsh ]' 'set -g default-command /bin/zsh ; set -g default-shell /bin/zsh'
## if '[ -e /usr/local/bin/zsh ]' 'set -g default-shell /usr/local/bin/zsh ; set -g default-command /usr/local/bin/zsh'
# fix pbcopy
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
# set-option -g default-command "reattach-to-user-namespace -l zsh"

# don't like the bell (?)
set -g bell-action current
# show tmux messages for 3000 ms
set -g display-time 1000

# status bar colors (qui sembra che i 256 colors non funzionino...)
set -g status-bg colour235
# ok 229
set -g status-fg colour250

setw -g window-status-bg colour233
setw -g window-status-fg colour247
set-window-option -g window-status-current-bg colour23
set-window-option -g window-status-current-fg colour231
# setw -g window-status-current-attr "underscore"

# display-panes colors
set -g display-panes-active-colour colour214
set -g display-panes-colour colour112

# barra dei "messaggi"
set -g message-bg colour221
set -g message-fg colour016

# emacs keys, che e' meglio.
set-window-option -g mode-keys vi
set -g status-keys emacs

# enable wm window titles
set -g set-titles on

# wm window title string (uses statusbar variables)
set -g set-titles-string "win:#I #W '#T'"

# center align the window list
set -g status-justify centre

# Gli id di window e pane partono da 1 e non da 0 (1 e' piu' comodo da premere)
set -g base-index 1
set -g pane-base-index 1


### Key bindings ###
####################

# open a man page in new window
## bind / command-prompt "split-window 'exec man %%'"

# ssh?
## bind '~' command-prompt "split-window 'exec ssh %%'"

# quick view of processes
## bind 'H' split-window "exec htop"

# splitto
bind 'S' split-window

# ctrl + page up (PPage): previous window
# ctrl + page down (NPage): next window
# bind -n C-PPage previous-window
# bind -n C-NPage next-window

# alt + page up (PPage): previous window
# alt + page down (NPage): next window
bind -n M-PPage previous-window
bind -n M-NPage next-window

# alt+left: previous window
# alt+right: next window
bind -n M-left previous-window
bind -n M-right next-window

# F8: previous window
# F9: next window
bind -n F8 previous-window
bind -n F9 next-window

# Set the prefix to ^A, or `, or ^F...
#### WARNING
# C'e' un problema se uso ` come prefix, ovvero viene preso
# anche quando si incolla con il mouse... quindi se incollo
# `ciao, lo prende come un comando.
### set -g prefix "`"
### bind "`" send-prefix
unbind C-b
set -g prefix C-a
# Al contrario di quanto visto in giro e' meglio fare "bind a" piuttosto che
# "bind C-a" perche' con C-a non posso piu' fare C-a normalmente per andare a
# inizio riga nella shell.
bind a send-prefix

# Bind appropriate commands similar to screen.
# lockscreen ^X x
## unbind C-X
## bind C-X lock-server
## unbind x
## bind x lock-server

# displays *
## unbind *
## bind * list-clients

# next ^@ ^N sp n
## unbind C-@
## bind C-@ next-window
## unbind C-N
## bind C-N next-window
## unbind " "
## bind " " next-window

# title A
unbind A
bind A command-prompt "rename-window %%"

# other ^A
## unbind C-A
## bind C-A last-window

# prev ^H ^P p ^?
## unbind C-H
## bind C-H previous-window
## unbind C-P
## bind C-P previous-window
## unbind BSpace
## bind BSpace previous-window

# quit \
## unbind \
## bind \ confirm-before "kill-server"

# kill K k
## unbind K
## bind K confirm-before "kill-window"
## unbind k
## bind k confirm-before "kill-window"

# redisplay C-L l
## unbind C-L
## bind C-L refresh-client
## unbind l
## bind l refresh-client

# split -v |
## unbind |
## bind | split-window
bind | split-window -h
bind - split-window -v

# pane movement
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# disabilita il mouse (per scrolling, selezione pane e co)
# (Funziona solo su linux ed e' una merda perche' poi non puoi selezionare con
# il mouse per il cut/paste)
setw -g mode-mouse off
set -g mouse-select-pane off
set -g mouse-resize-pane off
set -g mouse-select-window off

# reload config
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# monitor activity
bind m setw monitor-activity

# Se c'e' SSH_CONNECTION allora siamo in remoto e quindi uso C-f al posto di C-a.
if '[ ! -z "$SSH_CONNECTION" ]' 'unbind C-a ; set -g prefix C-f ; bind C-f send-prefix'

## # nuova sessione "Info"
## new-session -d -n TOP -s SysInfo 'exec htop'
## new-window -d -n NLOAD -t SysInfo:1 'exec nload'

# copia in X clipboard
# questo funziona su linux.
bind-key C-y save-buffer ~/.tmux.buffer \; run-shell "xclip -in -selection clipboard -d :0 < ~/.tmux.buffer && rm ~/.tmux.buffer" \; display-message "Buffer copiato nella Clipboard"
## if '[ -e /bin/zsh ]' 'set -g default-command /bin/zsh ; set -g default-shell /bin/zsh'
if '[[ $OSTYPE == darwin* ]]' 'bind-key C-y save-buffer ~/.tmux.buffer \; run-shell "reattach-to-user-namespace pbcopy < ~/.tmux.buffer && rm ~/.tmux.buffer" \; display-message "Buffer copiato nella Clipboard"'


# Esempio:
### # Crea una nuova sessione "main", e una finestra "info"
### # in "info" c'e' nload, htop e iotop splittati
### new -d -s main -n info 'exec nload'
### setw -tmain:0 aggressive-resize on
### splitw -t0 'exec iotop'
### splitw -t0 'exec htop'
### selectl -t0 even-vertical
### upp
### upp
### neww

#### COLOUR

# default statusbar colors
set-option -g status-bg colour235 #base02
set-option -g status-fg colour136 #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg colour244
set-window-option -g window-status-bg default
#set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg colour166 #orange
set-window-option -g window-status-current-bg default
#set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg colour235 #base02
set-option -g pane-active-border-fg colour240 #base01

# message text
set-option -g message-bg colour235 #base02
set-option -g message-fg colour166 #orange

# pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# clock
set-window-option -g clock-mode-colour colour64 #green

# solarized-dark
source /Users/sand/dev/others/tmux-colors-solarized/tmuxcolors-dark.conf

# Local settings
if '[ -e ~/.tmux.local ]' 'source ~/.tmux.local'

# vim: ft=tmux
